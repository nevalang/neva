# Авторизация для WebApp (TWA) через Telegram

Единственный выбранный вариант авторизации для webapp вне TMA — **Telegram Login Widget**. Он бесплатен, требует минимум кода и не добавляет новых инфраструктурных компонентов: достаточно бота, его токена и проверок на бэкенде по аналогии с `withAuth`.

## Почему Telegram
- Бесплатный и нативный для аудитории Telegram.
- Нет сторонних сервисов и OAuth-консолей: используем только токен бота.
- Простая проверка подлинности на бэкенде: HMAC по токену и контроль времени жизни данных.

## План интеграции
1. **Фронтенд**: подключить скрипт `https://telegram.org/js/telegram-widget.js`, указать `data-telegram-login`, `data-auth-url` и `data-request-access="write"` (если нужно). Передавать `data-userpic`, `data-radius` и др. опциональные параметры по дизайну.
2. **Бэкенд-маршрут** (например, `/auth/telegram`): принимать query-параметры, проверять `hash` по токену бота (SHA256 HMAC). Валидировать `auth_date` на свежесть.
3. **Создание пользовательского контекста**: при успешной проверке создавать user/session (cookie, header или bearer-токен), а затем использовать существующий middleware `withAuth`-подобного вида: проверка подписи ➜ извлечение user ➜ проксирование в handlers.
4. **Безопасность**:
   - хранить токен бота в конфиге/секрете;
   - ограничить TTL (`auth_date`), чтобы предотвратить replay;
   - логировать неуспешные попытки и странные user_id.

## Минимальная архитектура
- **Фронтенд**: только Telegram widget, без дополнительных SDK.
- **Бэкенд**: текущий стек + один обработчик `/auth/telegram` и middleware для проверки сессии. Никаких новых сервисов/БД, кроме хранения сессий, если уже используется.

## Что дальше
- После внедрения Telegram можно расширить список провайдеров (например, Google), сохраняя ту же схему middleware и проверки JWT/HMAC.
