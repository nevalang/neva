// ForEach applies a handler to each Data item in a stream to produce side-effects.
// It forwards the original stream unchanged.
pub def ForEach<T>(data stream<T>) (res stream<T>, err error) {
    del Del
    sw Switch<stream<T>>
    handler ISideEffector<T>
    ---
    :data -> [
        :res,
        sw:data,
        stream<T>::Data -> sw:case[0] -> handler
    ]
    handler:err -> :err
    sw:else -> del
}

pub interface ISideEffector<T>(T) (res any, err error)
